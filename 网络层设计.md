

# 基于moya的二次封装的网络框架(swift)
> 对于一个项目来说，网络层设计一直至关重要，最近在做一个swift的新项目，认真构思了一个星期，琢磨了一套swift方面的网络框架。仅供大家参考。

## 为什么选择moya
moya是对Alamofire的再次封装。它可以实现各种自定义配置，真正实现了对网络层的高度抽象。

还有一个优秀的网络框架([github地址](https://github.com/mmoaay/Bamboots))，大家可以看看，跟`moya`对比一下。

有关moya的介绍可以看看: [Moya的使用](https://github.com/chensx1993/moyaManager)

框架GitHub地址：[GitHub地址](https://github.com/chensx1993/moyaManager)

## 网络层设计
现在我们默认大家都很熟练用`moya`了，我们想想一个网络层设计需要什么，怎么通过`moya`更好的实现。

* *server层* ：可动态修改的域名，timeout，自定义HTTP parameters，header
* *安全性* ：SSL
* *缓存* ：沿用`moya`
* *回调方法* ：沿用`moya`, `response`需要根据自己服务器返回格式做出修改
* *拦截器* ：直接使用`moya`

### server层
我们先建个`WebService`类, 我目的是用来动态修改，需要不一定你一修改，就马上能够应用到Network，ㄟ( ▔, ▔ )ㄏ，可是我们要保留这个设计。

``` Swift
class WebService: NSObject {
    
    var rootUrl: String = "https://api.github.com"
    var manager: Alamofire.SessionManager = createManager()
    var headers: [String: String]? = defaultHeaders()
    var parameters: [String: Any]? = defaultParameters()
    var timeoutIntervalForRequest: Double = 20.0
    
    static let sharedInstance = WebService()
    private override init() {}
    
    static func defaultHeaders() -> [String : String]? {
        return ["deviceID" : "qwertyyu1234545",
                "Authorization": "tyirhjkkokjjjbggstvj"
        ]
    }
    
    static func defaultParameters() -> [String : Any]? {
        return ["platform" : "ios",
                "version" : "1.2.3",
        ]
    }
    
    // 自定义 session manager
    static func createManager() -> Alamofire.SessionManager {
        let configuration = URLSessionConfiguration.default
        configuration.httpAdditionalHeaders = Alamofire.SessionManager.defaultHTTPHeaders
        configuration.timeoutIntervalForRequest = 20.0
        
        let manager = Alamofire.SessionManager(configuration: configuration)
        manager.startRequestsImmediately = false
        return manager
    }
    
}

```

### 自定义一个TargetType


### enum取名规范：模块名 + API
